{% extends "base.html" %}
{% load static %}

{% block title %}Товары{% endblock %}

{% block content %}
<main>
    <header>
        <h1>Товары</h1>
    </header>

    <section class="filter-section" aria-label="Фильтр товаров">
        <form method="get" class="filter-form">
            <fieldset>
                <legend>Фильтр товаров</legend>

                <label for="min_price">Минимальная цена:</label>
                <input type="number" step="1" name="min_price" id="min_price" value="{{ request.GET.min_price }}">

                <label for="max_price">Максимальная цена:</label>
                <input type="number" step="1" name="max_price" id="max_price" value="{{ request.GET.max_price }}">

                <label for="category">Категория:</label>
                <select name="category" id="category">
                    <option value="">Все</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"s" %}selected{% endif %}>
                            {{ category.name }}
                        </option>
                    {% endfor %}
                </select>

                <button type="submit">Применить фильтр</button>
            </fieldset>
        </form>
    </section>

    {% if user.is_authenticated and user.is_staff %}
        <section class="admin-actions">
            <a href="{% url 'create_product' %}" class="button">Добавить товар</a>
        </section>
    {% endif %}

    <section class="products-grid" aria-label="Список товаров">
        {% for product in products %}
        <article class="product-card">
            <a href="{% url 'product_detail' product.pk %}" class="product-link">
                <header>
                    <h3>{{ product.name }}</h3>
                </header>
                <p>Цена: {{ product.price }} <abbr title="Белорусский рубль">BYN</abbr></p>
                <p>Единица: {{ product.get_unit_display }}</p>
                <p>Категория: {{ product.category.name }}</p>
            </a>

            <footer class="product-actions">
                {% if user.is_authenticated %}
                    <a href="{% url 'product_reviews' product_id=product.id %}" class="reviews-button">Отзывы</a>
                {% else %}
                    <a href="{% url 'login' %}?next={% url 'product_reviews' product_id=product.id %}" class="reviews-button">Отзывы</a>
                {% endif %}

                {% if user.is_authenticated and user.is_staff %}
                    <a href="{% url 'edit_product' product.pk %}" class="edit-button">Редактировать</a>
                {% endif %}
            </footer>
        </article>
        {% endfor %}
    </section>
</main>
{% endblock %}
